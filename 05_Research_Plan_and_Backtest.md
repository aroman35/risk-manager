# Подробный план исследования и бэктеста

## 0. Цель
Эмпирически показать, что EVT-контроллер улучшает риск-профиль MR-стратегий (меньше tail-loss/MaxDD при сопоставимой доходности) на криптофьючерсах.

## 1. Данные
- **Источники:** Tardis (trades/quotes), funding/open interest (если доступны), споты для кросс-сигналов.  
- **Инструменты:** BTCUSDT/USDC perpetual, затем ETH, SOL, топ-ликвидные альты.  
- **Период:** ≥ 2–3 года, включающий разные режимы волатильности (локальные кризисы/ралли).  
- **Схема полей:** `ts, price, qty, side, best_bid/ask, bid/ask_size, oi, funding, symbol`.  
- **Качество:** удаление дубликатов/out-of-order, синхронизация, фильтры микроструктуры (минимальный тик, скоростные всплески, quote stuffing).

## 2. Препроцессинг и признаки
- Агрегации: 1s/5s → 1m/5m баров; лог-доходности $r_t$; реал-вола (rv), парные спрэды/коинтеграция ($x_t$).  
- Признаки $Z_t$: bid-ask spread, order imbalance, microprice, rv, funding, OI, lead-lag с BTC, индексы риска (BTC.D, DXY/VIX proxy).  
- Нормализация/стандартизация; контроль пропусков; winsorization хвостов в признаках (не в таргете EVT).

## 3. Калибровка MR
- Оценка AR(1)/OU на $x_t$ (ADF/KPSS стационарность); rolling $W_{\text{MR}}$ (например, 5–20 дней).  
- Оценка GARCH/EGARCH/GJR на $\varepsilon_t$ (окно $W_{\text{GARCH}}$); проверка iid у $z_t$.  
- Конструкция сигнала: $s_t=\frac{x_t-\mu_t}{\hat{\sigma}_{eq,t}}$; пороги $\lambda_t$ начальные из историки.

## 4. EVT-контур
- Стандартизованные остатки $z_t$; declustering; выбор порога $u$ (MRL/стабильность).  
- POT-GPD MLE для $(\xi,\beta)$ на окне $W_{\text{EVT}}$; расчёт $q_{\alpha,t}$, $\mathrm{ES}_{\alpha,t}^{\text{tail}}$.  
- Режимы (Normal/High/Extreme) по $(\xi,q_{\alpha,t})$; правила изменения $\Theta_t=\{\gamma_t,\lambda_t,\kappa_t,\mu_t\}$.

## 5. Execution-риск
- Портфельная $\mathrm{VaR}/\mathrm{ES}$ (историческая + параметрическая $t_\nu$); бэктесты Kupiec/Christoffersen/Acerbi–Székely.  
- Правила: pre-trade и on-trade; эскалация при серийных нарушениях; согласование с EVT-контуром.

## 6. Бэктест-дизайн
- Walk-forward (train/validation/test), «скользящее окно»; отсутствие лукапа; реальная латентность (delay), комиссионные/спред/проскальзывание.  
- Режимы: **Baseline MR** vs **MR+EVT** vs **MR+EVT+Execution VaR/ES**.  
- Капитал/лимиты: одинаковые сеттинги; контроль маржи, ликвидности, ограничение объёма ордеров.

## 7. Метрики и статистика
- Доходность: CAGR, PnL, Sharpe/Sortino, MAR, Hit ratio, turnover.  
- Риск: MaxDD, tail-loss ($p$-квантили падений), частота VaR-исключений, кластеризация нарушений, время в режимах EVT.  
- Статистические сравнения: Diebold–Mariano для прогнозов риска; t-тесты/бутстрап различий метрик.

## 8. Робастность и абляции
- Окна $W_{\text{MR}}, W_{\text{GARCH}}, W_{\text{EVT}}$; разные $u$/$p_u$; альтернативы GARCH (EGARCH/GJR); ошибки $t_\nu$.  
- Упрощённый пороговый контроллер вместо EVT; отключение отдельных признаков $Z_t$.  
- Разные инструменты и периоды (stress subperiods).

## 9. Репликация и управление изменениями
- Контроль версий данных/параметров; seed; MLflow/wandb артефакты; CI юнит-тесты.  
- Отчеты: notebooks + статические отчёты (PDF/MD); логи контроллера EVT и execution-диспетчера.

## 10. Риски/ограничения и комплаенс
- Нестабильность хвостовых оценок при коротких окнах; выбор $u$; режимные сдвиги и ликвидность.  
- latency/инфраструктура; риск исполнения в экстремумах; корректность declustering.  
- Документирование ограничений модели для аттестации (model risk governance).

## 11. Источники
McNeil–Frey–Embrechts; Coles; Resnick; de Haan & Ferreira; Tsay; Engle; Bollerslev; **Jansen; Dobleman; Velu; Hardy; Nehren; Bell**.
